<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="gb2312"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="noindex,nofollow">
	<script src="jquery/jquery-2.1.1.min.js"></script>
	<link rel="stylesheet" rev="stylesheet" href="css/Member_Web_User_Message.css" type="text/css">
	<link rel="stylesheet" rev="stylesheet" href="css/Member_Web_User_Profile.css" type="text/css">
	<link rel="stylesheet" href="dropzone/basic.min.css" />
	<link rel="stylesheet" href="dropzone/dropzone.min.css" />
	<script src="dropzone/dropzone.min.js"></script>
	<script type="text/javascript" src="js/plugins/citypicker/distpicker.data.js"></script>
	<script type="text/javascript" src="js/plugins/citypicker/distpicker.js"></script>
<title>用户中心－系统消息</title>
	<style>
		img{
			width:50px;
		}
		input{
			width:50px;
		}
		td{
			height: 30px;
		}
	</style>
</head>
<body>

<div class="header-mod">
    <div class="header clearfix">
        <div class="logo">
           <a class="ajk-logo" href="#">百姓安居</a>
          <i class="split-icon"></i>
          <a class="sub-logo" href="#">用户中心</a>
        </div>
        <a href="" class="quit">
          <i class="iconfont quitIcon"></i>
          <span onclick="loginOut()">退出</span>
        </a>
    </div>
</div>

<div class="headerSub-mod">
	<div class="headerSub clearfix">

		<div class="user-info">
			<div class="info-sup clearfix">
			</div>
			<div class="info-sub clearfix">
				<ul>
					<li class="user-account">

					</li>
					<i class="split-icon"></i>
					<li class="user-type">
						<span id="landType"></span>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>


<div class="container">
	<div class="content clearfix">
		<!-- 侧边栏 -->
		<div class="side-menu">
    	<ul class="menu-list">
		<li>
			<a href="landlord.html" target="_self"><i class="iconfont"></i>个人信息</a>
		</li>
		<li>
			<a href="houseList.html" target="_self"><i class="iconfont"></i>房源管理</a>
		</li>
		<li>
			<a href="shopList.html" target="_self"><i class="iconfont"></i>商铺管理</a>
		</li>
	</ul>	
		</div>
		<div class="right-content">
			<div class="right-cont">
				<ul class="tab-list clearfix">
					<li onclick="">房屋发布/修改</li>
				</ul>
			<div class="no-msg">
				<br/><br/><br/>
				<div>
					<table id="houseTable" border="1" cellpadding="0" cellspacing="0" align="center" width="750px">

						<tr>
							<td>所在地：<span id="areaInfo"></span></td>
							<td>
								<div class="control-group">
									<div class="controls">
										<div data-toggle="distpicker">

											<div class="form-group area" style=" float:left;">
												<select class="form-control" id="province1"></select>
											</div>
											<div class="form-group area" style=" float:left;">
												<select class="form-control" id="city1"></select>
											</div>
											<div class="form-group area" style=" float:left;">
												<select class="form-control" id="district1"></select>
											</div>

										</div>
									</div>
								</div>
							</td>
							<td> <button onclick="edit()">修改地址</button></td>
						</tr>

						<tr>
							<td>
							小区:<input id="community">
							</td>
							<td>
								<input id="build">幢
								<input id="unit">单元
								<input id="room">室
							</td>
							<td>
								总楼层<input id="allLevel">
								该楼层<input id="level">
							</td>
						</tr>
						<tr>
							<td>
								面积:<input id="area">
							</td>
							<td>
								租金:<input id="rent">
								付款方式:<select id="payType">
											<option value="押一付一">押一付一</option>
											<option value="押一付三">押一付三</option>
											<option value="半年一付">半年一付</option>
											<option value="一年一付">一年一付</option>
										</select>
							</td>
							<td>
								装修类型:<select id="decorate">
											<option value="毛坯">毛坯</option>
											<option value="简装修">简装修</option>
											<option value="精装修">精装修</option>
											<option value="豪华装修">豪华装修</option>
										</select>
							</td>
						</tr>

						<tr>
							<td>
								出租类型:<select id="roomType">
											<option value="整租">整租</option>
											<option value="合租">合租</option>
										</select>
							</td>
							<td>
								房屋朝向:<select id="toward">
											<option value="朝南">朝南</option>
											<option value="朝北">朝北</option>
											<option value="朝东">朝东</option>
											<option value="朝西">朝西</option>
										</select>
							</td>
							<td>
								电梯:
								<select id="elevator">
									<option value="是">是</option>
									<option value="否">否</option>
								</select>
							</td>
						</tr>

						<tr >
							<td id="facilities" colspan="3">
							</td>
						</tr>

						<tr>
							<td colspan="3">
								联系人:<input id="contactName">
								电  话:<input id="conMobile">
							</td>
						</tr>

						<tr>
							<td colspan="3" id="houseImg">
							</td>
						</tr>

						<tr>
							<td colspan="3">
								<div class="dropzone" id="imgUpload" style="width: 200px;margin: 0 auto">
								</div>
							</td>
						</tr>

						<tr>
							<td colspan="3">
								标题:<input id="title"style="width: 500px">
							</td>
						</tr>
						<tr>
							<td colspan="3">
								房屋简介:<br/>
								<textarea cols="50" rows="20" id="info"></textarea>
							</td>
						</tr>
						<tr>
							<td colspan="3">
								<button onclick="refresh()">修改</button>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</div>



</div>
</div>
</body>
		<script>
			var houseId = window.location.search.split("=").pop();

			$("#province1").bind("change",
					function(){
						var province=$("#province1").val();
					}
			);


			function init(){
				if(houseId==""){
					$.ajax({
						type: "GET",
						//请求的媒体类型
						contentType: "application/json;charset=UTF-8",
						//返回数据格式
						dataType: "json",
						//请求地址
						url: "http://localhost:8080/getAllFac",
						//请求成功
						success: function (result) {
							console.log(result)
							var str = "配套设施:";
							$(result).each(function(index,item){
								str += "<input type='checkbox' value='"+item.facId+"'>"+item.facName
							})
							$("#facilities").append(str)

						},
						//请求失败，包含具体的错误信息
						error: function (e) {
							console.log(e.status);
							console.log(e.responseText);
						}
					})
				}else{
					$.ajax({
						type: "GET",
						//请求的媒体类型
						contentType: "application/json;charset=UTF-8",
						//返回数据格式
						dataType: "json",
						//请求地址
						url: "http://localhost:8080/getHouseByHouseId?houseId="+houseId,
						//请求成功
						success: function (result) {
							console.log(result);
							$("#areaInfo").text(result.provinceId+result.cityId+result.areaId);
							$("#community").val(result.community);
							$("#build").val(result.build);
							$("#unit").val(result.unit);
							$("#room").val(result.room);
							$("#allLevel").val(result.allLevel);
							$("#level").val(result.level);
							$("#area").val(result.area);
							$("#rent").val(result.rent);
							$("#payType").val(result.payType);
							$("#decorate").val(result.decorate);
							$("#roomType").val(result.roomType);
							$("#toward").val(result.toward);
							$("#elevator").val(result.elevator);
							$("#title").val(result.title);
							$("#info").text(result.info);
							$("#contactName").val(result.contact.conName);
							$("#conMobile").val(result.contact.mobile);
							var str = "配套设施";
							$(result.facilitiesVOList).each(function(index,item){
								if(item.checked==true){
									str += "<input type='checkbox' checked='checked' value='"+item.facId+"'>"+item.facName;
								}else{
									str += "<input type='checkbox'value='"+item.facId+"'>"+item.facName;
								}
							})
							$("#facilities").html(str);
							if(result.imgList!=null){
								var strImg = "房屋图片";
								$(result.imgList).each(function(index,item){
									strImg += "<img src="+item.img_url+">"
								})
								$("#houseImg").append(strImg)
							}
						},
						//请求失败，包含具体的错误信息
						error: function (e) {
							console.log(e.status);
							console.log(e.responseText);
						}
					})
				}

			}
			init();
			function edit(){
				$.ajax({
					type: "POST",
					//请求的媒体类型
					contentType: "application/json;charset=UTF-8",
					//返回数据格式
					dataType: "json",
					//请求地址
					url: "http://localhost:8080/editHouseArea",
					data:JSON.stringify({
						"houseId":houseId,
						"provinceId":$("#province1").val(),
						"cityId":$("#city1").val(),
						"areaId":$("#district1").val()
					}),
					//请求成功
					success: function (result) {
						window.location.reload();

					},
					//请求失败，包含具体的错误信息
					error: function (e) {
						console.log(e.status);
						console.log(e.responseText);
					}
				})
			}


		function refresh(){
			var facilitiesList = new Array();
			$("input:checkbox:checked").each(function(index,item){
				var facilitie = {
					facId:item.value,
					facName:item.nextSibling.nodeValue
				}
				facilitiesList.push(facilitie);
			})
			var imgList = new Array();
			$("#houseImg img").each(function(index,item){
				var img = {"img_url":$(item).attr("src")}
				console.log(img.img_url+"----+++++------")
				imgList.push(img);
			})
				var url;
				if(houseId!=""){
					url = "http://localhost:8080/editHouseByHouseId"
				}else{
					url = "http://localhost:8080/addHouseNew";
				}
			if(houseId==""){
				$.ajax({
					type: "POST",
					//请求的媒体类型
					contentType: "application/json;charset=UTF-8",
					//返回数据格式
					dataType: "json",
					//请求地址
					url: url,
					data:JSON.stringify({
						"community":$("#community").val(),
						"build":$("#build").val(),
						"unit":$("#unit").val(),
						"room":$("#room").val(),
						"allLevel":$("#allLevel").val(),
						"level":$("#level").val(),
						"area":$("#area").val(),
						"rent":$("#rent").val(),
						"payType":$("#payType").val(),
						"decorate":$("#decorate").val(),
						"roomType":$("#roomType").val(),
						"toward":$("#toward").val(),
						"elevator":$("#elevator").val(),
						"title":$("#title").val(),
						"info":$("#info").val(),
						"provinceId":$("#province1").val(),
						"cityId":$("#city1").val(),
						"areaId":$("#district1").val(),
						"facilitiesList":facilitiesList,
						"contact":{
							"conName":$("#contactName").val(),
							"mobile":$("#conMobile").val()
						},
						"imgList":imgList
					}),
					//请求成功
					success: function (result) {
						alert("添加成功");
						window.location.href="houseList.html";
					},
					//请求失败，包含具体的错误信息
					error: function (e) {
						console.log(e.status);
						console.log(e.responseText);
					}
				})
			}else{
				$.ajax({
					type: "POST",
					//请求的媒体类型
					contentType: "application/json;charset=UTF-8",
					//返回数据格式
					dataType: "json",
					//请求地址
					url: url,
					data:JSON.stringify({
						"houseId":houseId,
						"community":$("#community").val(),
						"build":$("#build").val(),
						"unit":$("#unit").val(),
						"room":$("#room").val(),
						"allLevel":$("#allLevel").val(),
						"level":$("#level").val(),
						"area":$("#area").val(),
						"rent":$("#rent").val(),
						"payType":$("#payType").val(),
						"decorate":$("#decorate").val(),
						"roomType":$("#roomType").val(),
						"toward":$("#toward").val(),
						"elevator":$("#elevator").val(),
						"title":$("#title").val(),
						"info":$("#info").val(),
						"facilitiesList":facilitiesList,
						"contact":{
							"conName":$("#contactName").val(),
							"mobile":$("#conMobile").val()
						},
						"imgList":imgList
					}),
					//请求成功
					success: function (result) {
						alert("修改成功");
						window.location.href="houseList.html";
					},
					//请求失败，包含具体的错误信息
					error: function (e) {
						console.log(e.status);
						console.log(e.responseText);
					}
				})
			}

		}

			Dropzone.options.imgUpload = {
				url: "uploadIcon", // 文件提交地址
				method: "post",  // 也可用put
				paramName: "dropzFile", // 默认为file
				maxFiles: 1,// 一次性上传的文件数量上限
				maxFilesize: 2, // 文件大小，单位：MB
				acceptedFiles: ".jpg,.gif,.png,.jpeg,.txt,.doc,.docx", // 上传的类型
				addRemoveLinks: true,
				parallelUploads: 1,// 一次上传的文件数量
				//previewsContainer:"#preview", // 上传图片的预览窗口
				dictDefaultMessage: '跟换商铺图片',
				dictMaxFilesExceeded: "您最多只能上传1个文件！",
				dictResponseError: '文件上传失败!',
				dictInvalidFileType: "文件类型只能是*.jpg,*.gif,*.png,*.jpeg,.txt,.doc,.docx。",
				dictFallbackMessage: "浏览器不受支持",
				dictFileTooBig: "文件过大上传文件最大支持.",
				dictRemoveLinks: "删除",
				dictCancelUpload: "取消",
				init: function () {
					this.on("addedfile", function (file) {
						// 上传文件时触发的事件
					});
					this.on("success", function (file, data) {
						// 上传成功触发的事件
						var strImg = "<img src='"+data.fileName+"'>";
						$("#houseImg").append(strImg);
					});
					this.on("error", function (file, data) {
						// 上传失败触发的事件
						console.error();
					});
					this.on("removedfile", function (file) {
						// 删除文件时触发的方法
					});
				}
			}

		</script>

</html>


